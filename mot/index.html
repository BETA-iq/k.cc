<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>متجر الهواتف - ملف واحد</title>
  <style>
    :root{
      --nili: #1f3a8a; /* نيلي */
      --orange: #ff7a00; /* برتقالي */
      --bg: #0b1220;
      --card: #0f1724;
      --glass: rgba(255,255,255,0.03);
      --text: #e6eef8;
      --muted: #b6c6e0;
      font-family: 'Cairo', sans-serif;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg),#071027);color:var(--text);}
    a{color:inherit}
    header{display:flex;align-items:center;gap:16px;padding:16px 20px;border-bottom:1px solid rgba(255,255,255,0.04);}
    .logo{width:160px;height:56px;background:linear-gradient(90deg,var(--nili),var(--orange));display:flex;align-items:center;justify-content:center;border-radius:10px;font-weight:700}
    .logo small{font-size:12px;opacity:.95}
    .search{flex:1;display:flex;gap:8px}
    .search input{flex:1;padding:10px 12px;border-radius:10px;border:0;background:var(--glass);color:var(--text);outline:none}
    .top-actions{display:flex;gap:8px}
    button.btn{background:var(--nili);border:0;padding:10px 14px;border-radius:10px;color:white;cursor:pointer}
    button.btn.alt{background:transparent;border:1px solid rgba(255,255,255,0.06)}

    main{display:grid;grid-template-columns:260px 1fr;gap:20px;padding:20px}
    aside{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:16px;border-radius:12px}
    .categories h3{margin:0 0 8px 0;color:var(--muted)}
    .cat{display:flex;flex-direction:column;gap:8px}
    .cat button{background:transparent;border:0;padding:8px 10px;border-radius:8px;text-align:right;cursor:pointer;color:var(--text)}
    .cat button.active{background:linear-gradient(90deg,var(--nili),var(--orange));color:#001021}

    .content-top{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:14px}

    .card{background:var(--card);padding:12px;border-radius:12px;display:flex;flex-direction:column;gap:8px}
    .card .img{width:100%;height:200px;border-radius:10px;background:#0b1220;display:flex;align-items:center;justify-content:center;overflow:hidden}
    .card .img img{width:200px;height:200px;object-fit:cover}
    .card h4{margin:0;font-size:16px}
    .price-row{display:flex;justify-content:space-between;align-items:center;gap:8px}
    .price{font-weight:700}
    .card .actions{display:flex;gap:8px}
    .card input[type=number]{width:72px;padding:6px;border-radius:8px;border:0;background:rgba(255,255,255,0.03);color:var(--text)}

    /* cart */
    .cart-btn{position:fixed;left:20px;bottom:20px;background:linear-gradient(90deg,var(--orange),var(--nili));padding:12px 16px;border-radius:12px;color:#031018;font-weight:800;box-shadow:0 10px 30px rgba(0,0,0,0.4);cursor:pointer}

    /* modal */
    .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.5);z-index:200}
    .modal.show{display:flex}
    .modal .panel{width:920px;max-width:95%;background:#071427;padding:18px;border-radius:12px}
    .orders-list{max-height:420px;overflow:auto}
    .order-item{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:12px;border-radius:8px;margin-bottom:8px}

    /* admin bar */
    .admin-bar{display:flex;gap:8px;align-items:center}
    .badge{padding:6px 8px;border-radius:8px;background:rgba(255,255,255,0.03);font-size:13px}

    footer{padding:20px;text-align:center;color:var(--muted)}

    /* responsive */
    @media (max-width:900px){main{grid-template-columns:1fr}aside{order:2}}
  </style>
</head>
<body>
  <header>
    <div class="logo" id="logo">لوغو (اضغط لتعديل)</div>
    <div class="search">
      <input id="search" placeholder="ابحث عن منتج أو نوع (مثال: آيفون)" />
    </div>
    <div class="top-actions">
      <div class="admin-bar">
        <button class="btn alt" id="ownerBtn">وضع صاحب المتجر</button>
        <div class="badge">البريد: <strong style="margin-left:6px">betabot5799@gmail.com</strong></div>
      </div>
    </div>
  </header>

  <main>
    <aside>
      <div class="categories">
        <h3>الأقسام</h3>
        <div class="cat" id="categories"></div>
      </div>
      <hr style="margin:12px 0;border:0;border-top:1px solid rgba(255,255,255,0.03)" />
      <div>
        <h3>لوحة التحكم السريعة</h3>
        <div style="display:flex;flex-direction:column;gap:8px;margin-top:8px">
          <button class="btn" id="viewOrders">عرض الطلبات (صاحب المتجر)</button>
          <button class="btn alt" id="clearOrders">مسح الطلبات</button>
          <button class="btn alt" id="exportOrders">تصدير الطلبات (JSON)</button>
        </div>
      </div>
    </aside>

    <section>
      <div class="content-top">
        <div><h2 id="sectionTitle">كل المنتجات</h2><div style="color:var(--muted);font-size:14px">شبكة عرض (Grid) — لون نيلي وبرتقالي</div></div>
        <div style="display:flex;gap:8px;align-items:center">
          <div class="badge" id="cartCount">السلة: 0</div>
          <button class="btn" id="openCart">فتح السلة</button>
        </div>
      </div>

      <div class="grid" id="productGrid"></div>
    </section>
  </main>

  <button class="cart-btn" id="openCartFloating">السلة • عرض الطلب</button>

  <!-- Modal -->
  <div class="modal" id="modal">
    <div class="panel">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
        <h3 id="modalTitle">السلة</h3>
        <div style="display:flex;gap:8px;align-items:center">
          <button class="btn" id="closeModal">إغلاق</button>
        </div>
      </div>

      <div id="modalBody"></div>
    </div>
  </div>

  <footer>نسخة مبدئية — قم بتعديل أسماء المنتجات بالضغط على أي زر تعديل في وضع صاحب المتجر. مكان اللوجو قابل للتعديل. الصور الافتراضية 200×200.  </footer>

  <script>
  /*
    ملف واحد HTML/CSS/JS
    الوظائف الأساسية:
    - 7 أقسام مع منتجات "test"
    - صور افتراضية 200x200
    - سلة مشتريات، تعديل كمية
    - نموذج دفع/طلب يحفظ في localStorage ويعرض في لوحة صاحب المتجر
    - خيار Owner Mode لتمكين تحرير المنتجات
    - إعداد جاهز لاستخدام EmailJS (تعليق) لإرسال البريد تلقائياً إذا أردت تكوينه
  */

  // بيانات مبدئية: 7 اقسام
  const CATEGORIES = [
    {id:'offers', name:'عروض'},
    {id:'phones', name:'هواتف'},
    {id:'chargers', name:'شواحن'},
    {id:'watches', name:'ساعات'},
    {id:'cases', name:'حماية وكفرات'},
    {id:'accessories', name:'اكسسوارات الهاتف'},
    {id:'others', name:'أخرى'}
  ];

  // انشئ منتجات "test" لكل قسم (يمكنك تعديلهم لاحقاً في Owner Mode)
  let PRODUCTS = [];
  let idCounter = 1;
  CATEGORIES.forEach(cat=>{
    const count = cat.id === 'phones' ? 6 : 4; // مزيد في الهواتف
    for(let i=0;i<count;i++){
      const subtype = (cat.id==='phones' || cat.id==='cases') ? (i%2===0?'آيفون':'سامسونج') : '';
      PRODUCTS.push({
        id: 'p'+(idCounter++),
        title: `test ${cat.name} ${i+1}`,
        category: cat.id,
        subtype: subtype,
        price: (Math.floor(Math.random()*300)+100).toString(), // قيمة افتراضية يمكن تعديلها
        img: '', // فارغ -> نعرض placeholder
        qty:1
      })
    }
  });

  // عناصر DOM
  const categoriesDiv = document.getElementById('categories');
  const grid = document.getElementById('productGrid');
  const sectionTitle = document.getElementById('sectionTitle');
  const cartCount = document.getElementById('cartCount');
  const modal = document.getElementById('modal');
  const modalBody = document.getElementById('modalBody');
  const modalTitle = document.getElementById('modalTitle');

  // سلة مشتريات
  let CART = JSON.parse(localStorage.getItem('cart_demo_v1')||'[]');
  let ORDERS = JSON.parse(localStorage.getItem('orders_demo_v1')||'[]');

  function saveState(){
    localStorage.setItem('cart_demo_v1', JSON.stringify(CART));
    localStorage.setItem('orders_demo_v1', JSON.stringify(ORDERS));
  }

  function renderCategories(){
    categoriesDiv.innerHTML = '';
    CATEGORIES.forEach((c,i)=>{
      const btn = document.createElement('button');
      btn.textContent = c.name;
      btn.onclick = ()=>{ selectCategory(c.id); document.querySelectorAll('.cat button').forEach(b=>b.classList.remove('active')); btn.classList.add('active') }
      if(i===0) btn.classList.add('active');
      categoriesDiv.appendChild(btn);
    })
  }

  let currentCat = '';
  function selectCategory(catId){
    currentCat = catId;
    const cat = CATEGORIES.find(c=>c.id===catId);
    sectionTitle.textContent = cat ? cat.name : 'كل المنتجات';
    renderProducts();
  }

  function placeholderSVG(text){
    // صورة svg بأبعاد 200x200
    const svg = `<svg xmlns='http://www.w3.org/2000/svg' width='200' height='200'><rect width='100%' height='100%' fill='${escapeHtml('#0b1220')}'/><text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' font-family='Cairo, sans-serif' font-size='18' fill='${escapeHtml('#9fb4f0')}'>${escapeHtml(text)}</text></svg>`;
    return 'data:image/svg+xml;utf8,'+encodeURIComponent(svg);
  }
  function escapeHtml(s){return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')}

  function renderProducts(){
    const q = document.getElementById('search').value.trim();
    grid.innerHTML = '';
    const list = PRODUCTS.filter(p=>{
      if(currentCat && currentCat!==''){
        if(p.category !== currentCat) return false;
      }
      if(q){
        const low = q.toLowerCase();
        return (p.title||'').toLowerCase().includes(low) || (p.subtype||'').toLowerCase().includes(low) || p.category.includes(low);
      }
      return true;
    })
    list.forEach(p=>{
      const card = document.createElement('div'); card.className='card';
      const imgWrap = document.createElement('div'); imgWrap.className='img';
      const img = document.createElement('img');
      img.src = p.img || placeholderSVG(p.title+'\n200x200');
      img.alt = p.title;
      imgWrap.appendChild(img);
      card.appendChild(imgWrap);
      const h4 = document.createElement('h4'); h4.textContent = p.title + (p.subtype? ' — '+p.subtype:''); card.appendChild(h4);
      const desc = document.createElement('div'); desc.style.color='var(--muted)'; desc.style.fontSize='13px'; desc.textContent = 'التصنيف: ' + (CATEGORIES.find(c=>c.id===p.category)?.name||p.category); card.appendChild(desc);
      const prRow = document.createElement('div'); prRow.className='price-row';
      const price = document.createElement('div'); price.className='price'; price.textContent = formatPrice(p.price); prRow.appendChild(price);
      const qty = document.createElement('input'); qty.type='number'; qty.min=1; qty.value = p.qty||1; qty.onchange = ()=>{p.qty = Number(qty.value)}; prRow.appendChild(qty);
      card.appendChild(prRow);

      const actions = document.createElement('div'); actions.className='actions';
      const addBtn = document.createElement('button'); addBtn.className='btn'; addBtn.textContent='أضف إلى السلة'; addBtn.onclick = ()=>{ addToCart(p.id, Number(qty.value)); }
      actions.appendChild(addBtn);

      // Owner edit buttons (hidden until owner mode)
      const editBtn = document.createElement('button'); editBtn.className='btn alt'; editBtn.textContent='تعديل'; editBtn.style.display='none';
      editBtn.onclick = ()=>{ openEditProductModal(p) }
      actions.appendChild(editBtn);

      card.appendChild(actions);
      grid.appendChild(card);
    })
  }

  function formatPrice(v){
    if(!v && v!==0) return '---';
    return v + ' IQD';
  }

  function addToCart(pid,qty=1){
    const prod = PRODUCTS.find(p=>p.id===pid); if(!prod) return;
    const existing = CART.find(i=>i.id===pid);
    if(existing){ existing.qty += qty; } else { CART.push({id:pid,title:prod.title,price:prod.price,qty:qty}) }
    saveState(); updateCartBadge(); alert('تم إضافة المنتج إلى السلة')
  }

  function updateCartBadge(){
    const count = CART.reduce((s,i)=>s+i.qty,0);
    cartCount.textContent = 'السلة: ' + count;
  }

  function openCart(){
    modalTitle.textContent = 'سلة المشتريات';
    modalBody.innerHTML = '';
    const wrapper = document.createElement('div');
    if(CART.length===0){ wrapper.innerHTML = '<div style="padding:20px;color:var(--muted)">السلة فارغة</div>'; }
    else{
      const list = document.createElement('div'); list.className='orders-list';
      CART.forEach(item=>{
        const el = document.createElement('div'); el.className='order-item';
        el.innerHTML = `<div style="display:flex;justify-content:space-between;align-items:center"><div><strong>${escapeHtml(item.title)}</strong><div style="color:var(--muted);font-size:13px">السعر: ${escapeHtml(item.price)} IQD × ${item.qty}</div></div><div><button class='btn alt' onclick='decreaseQty("${item.id}")'>-</button><button class="btn" onclick='increaseQty("${item.id}")'>+</button><button class="btn alt" onclick='removeFromCart("${item.id}")'>حذف</button></div></div>`;
        list.appendChild(el);
      })
      wrapper.appendChild(list);
      const total = CART.reduce((s,i)=>s + (Number(i.price)||0) * i.qty,0);
      const summary = document.createElement('div'); summary.style.marginTop='12px'; summary.innerHTML = `<div style="display:flex;justify-content:space-between;align-items:center"><strong>المجموع الكلي:</strong><div style="font-weight:800">${total} IQD</div></div>`;
      wrapper.appendChild(summary);

      const formWrap = document.createElement('div'); formWrap.style.marginTop='12px';
      formWrap.innerHTML = `
        <h4>نموذج إتمام الطلب</h4>
        <div style="display:flex;flex-direction:column;gap:8px;margin-top:8px">
          <input id='custName' placeholder='الاسم الكامل' style='padding:10px;border-radius:8px;border:0;background:var(--glass);color:var(--text)' />
          <input id='custPhone' placeholder='رقم الهاتف' style='padding:10px;border-radius:8px;border:0;background:var(--glass);color:var(--text)' />
          <input id='custAddress' placeholder='العنوان (المنطقة، المدينة)' style='padding:10px;border-radius:8px;border:0;background:var(--glass);color:var(--text)' />
          <textarea id='custNote' placeholder='ملاحظة (اختياري)' style='padding:10px;border-radius:8px;border:0;background:var(--glass);color:var(--text)'></textarea>
          <div style='display:flex;gap:8px'>
            <button class='btn' id='placeOrderBtn'>إرسال الطلب لصاحب المتجر</button>
            <button class='btn alt' id='previewBtn'>معاينة الطلب</button>
          </div>
        </div>
      `;
      wrapper.appendChild(formWrap);
    }
    modalBody.appendChild(wrapper);
    modal.classList.add('show');

    // attach listeners
    setTimeout(()=>{
      const previewBtn = document.getElementById('previewBtn');
      if(previewBtn) previewBtn.onclick = previewOrder;
      const placeBtn = document.getElementById('placeOrderBtn');
      if(placeBtn) placeBtn.onclick = placeOrder;
    },50)
  }

  // small helpers referenced from generated HTML
  window.decreaseQty = function(id){
    const it = CART.find(i=>i.id===id); if(!it) return; if(it.qty>1) it.qty--; else CART = CART.filter(x=>x.id!==id); saveState(); openCart(); updateCartBadge();
  }
  window.increaseQty = function(id){ const it = CART.find(i=>i.id===id); if(!it) return; it.qty++; saveState(); openCart(); updateCartBadge(); }
  window.removeFromCart = function(id){ CART = CART.filter(i=>i.id!==id); saveState(); openCart(); updateCartBadge(); }

  function previewOrder(){
    const name = document.getElementById('custName').value || '-';
    const phone = document.getElementById('custPhone').value || '-';
    const addr = document.getElementById('custAddress').value || '-';
    const note = document.getElementById('custNote').value || '-';
    const summary = CART.map(i=>`${i.title} × ${i.qty} — ${i.price} IQD`).join('\n');
    alert(`معاينة الطلب:\n\nالاسم: ${name}\nالهاتف: ${phone}\nالعنوان: ${addr}\n\nالمنتجات:\n${summary}`)
  }

  function placeOrder(){
    const name = document.getElementById('custName').value.trim();
    const phone = document.getElementById('custPhone').value.trim();
    const addr = document.getElementById('custAddress').value.trim();
    const note = document.getElementById('custNote').value.trim();
    if(!name || !phone || !addr){ alert('الرجاء تعبئة الاسم، رقم الهاتف، والعنوان.'); return }
    if(CART.length===0){ alert('السلة فارغة'); return }

    const total = CART.reduce((s,i)=>s + (Number(i.price)||0)*i.qty,0);
    const order = { id: 'o'+Date.now(), name, phone, addr, note, items:JSON.parse(JSON.stringify(CART)), total, createdAt: new Date().toISOString() };

    // احفظ محلياً
    ORDERS.push(order); saveState();

    // أظهر رسالة شكر
    modalBody.innerHTML = `<div style="padding:18px;text-align:center"><h3>شكراً على طلبك!</h3><p>تم إرسال الطلب لصاحب المتجر وسيتم التواصل معك قريبا.</p><button class='btn' id='closeAfter'>اغلاق</button></div>`;
    CART = []; saveState(); updateCartBadge();
    document.getElementById('closeAfter').onclick = ()=>{ modal.classList.remove('show') }

    // أيضاً أضف الطلب إلى واجهة صاحب المتجر (لو كانت مفتوحة)
    renderOrdersPanel();

    // ---------- إرسال بريد تلقائي إلى صاحب المتجر (اختياري) ----------
    // ملاحظة: هذا جزء اختياري يتطلب خدمة طرف ثالث (مثل EmailJS أو Formspree).
    // إن أردت أن يعمل إرسال البريد تلقائياً من المتصفح دون مغادرة الصفحة، فعليك
    // تهيئة EmailJS أو خدمة مماثلة وإدخال مفاتيحك أسفل. تركنا التعليمة مشروحة

    /*
    // مثال باستخدام EmailJS (https://www.emailjs.com):
    // 1) سجل في EmailJS وأنشئ خدمة(service), وtemplate
    // 2) ضع القيم المناسبة في SERVICE_ID, TEMPLATE_ID, USER_ID

    const SERVICE_ID = 'your_service_id';
    const TEMPLATE_ID = 'your_template_id';
    const USER_ID = 'your_public_key';

    if(SERVICE_ID !== 'your_service_id'){
      // بناء بيانات template حسب ما أنشأته في EmailJS
      const templateParams = {
        to_email: 'betabot5799@gmail.com',
        order_id: order.id,
        customer_name: order.name,
        customer_phone: order.phone,
        address: order.addr,
        note: order.note,
        items: order.items.map(it=>`${it.title} x ${it.qty} - ${it.price} IQD`).join('\n'),
        total: order.total
      };
      emailjs.send(SERVICE_ID, TEMPLATE_ID, templateParams, USER_ID)
        .then(()=> console.log('Email sent'))
        .catch(e=> console.error('Email error', e));
    }
    */

    // END placeOrder
  }

  // Owner / Admin features
  let ownerMode = false;
  document.getElementById('ownerBtn').onclick = ()=>{
    const pass = prompt('ادخل كلمة مرور وضع صاحب المتجر (الافتراضي: admin)');
    if(pass === null) return;
    if(pass === 'admin'){
      toggleOwnerMode(true);
      alert('تم تفعيل وضع صاحب المتجر. يمكنك تعديل المنتجات الآن.')
    } else { alert('كلمة المرور خطأ') }
  }

  function toggleOwnerMode(enable){
    ownerMode = enable;
    // إظهار أزرار تعديل
    document.querySelectorAll('.card').forEach((c,idx)=>{
      const btn = c.querySelector('.btn.alt'); if(btn) btn.style.display = ownerMode ? 'inline-block' : 'none';
    })
  }

  // إنشاء نافذة تعديل منتج
  function openEditProductModal(p){
    modalTitle.textContent = 'تعديل المنتج';
    modalBody.innerHTML = '';
    const wrap = document.createElement('div');
    wrap.innerHTML = `
      <div style='display:flex;flex-direction:column;gap:8px'>
        <input id='editTitle' value='${escapeHtml(p.title)}' style='padding:10px;border-radius:8px;border:0;background:var(--glass);color:var(--text)' />
        <input id='editPrice' value='${escapeHtml(p.price)}' style='padding:10px;border-radius:8px;border:0;background:var(--glass);color:var(--text)' />
        <input id='editImg' placeholder='رابط صورة (اتركه فارغاً لاستخدام الافتراضي 200x200)' value='${escapeHtml(p.img||'')}' style='padding:10px;border-radius:8px;border:0;background:var(--glass);color:var(--text)' />
        <div style='display:flex;gap:8px'>
          <button class='btn' id='saveProd'>حفظ</button>
          <button class='btn alt' id='cancelProd'>إلغاء</button>
        </div>
      </div>
    `;
    modalBody.appendChild(wrap);
    modal.classList.add('show');
    setTimeout(()=>{
      document.getElementById('saveProd').onclick = ()=>{
        p.title = document.getElementById('editTitle').value.trim()||p.title;
        p.price = document.getElementById('editPrice').value.trim()||p.price;
        p.img = document.getElementById('editImg').value.trim()||'';
        modal.classList.remove('show'); renderProducts();
      }
      document.getElementById('cancelProd').onclick = ()=>{ modal.classList.remove('show') }
    },50)
  }

  // Orders panel (for owner)
  function renderOrdersPanel(){
    modalTitle.textContent = 'طلبات المتجر';
    modalBody.innerHTML = '';
    const wrap = document.createElement('div');
    if(ORDERS.length===0){ wrap.innerHTML = '<div style="padding:20px;color:var(--muted)">لا توجد طلبات بعد</div>'; }
    else{
      const list = document.createElement('div'); list.className='orders-list';
      ORDERS.slice().reverse().forEach(o=>{
        const el = document.createElement('div'); el.className='order-item';
        const itemsHtml = o.items.map(it=>`<div>${escapeHtml(it.title)} × ${it.qty} - ${escapeHtml(it.price)} IQD</div>`).join('');
        el.innerHTML = `<div style='display:flex;justify-content:space-between;align-items:flex-start;gap:8px'><div style='flex:1'><strong>طلب #${o.id}</strong><div style='color:var(--muted);font-size:13px'>${new Date(o.createdAt).toLocaleString()}</div><div style='margin-top:8px'>الاسم: ${escapeHtml(o.name)}<br>الهاتف: ${escapeHtml(o.phone)}<br>العنوان: ${escapeHtml(o.addr)}<br>ملاحظة: ${escapeHtml(o.note||'-')}</div></div><div style='width:260px'>${itemsHtml}<div style='margin-top:8px;font-weight:800'>المجموع: ${o.total} IQD</div><div style="display:flex;gap:6px;margin-top:8px"><button class='btn' onclick='markDone("${o.id}")'>تم الاستلام</button><button class='btn alt' onclick='deleteOrder("${o.id}")'>حذف</button></div></div></div>`;
        list.appendChild(el);
      })
      wrap.appendChild(list);
    }
    modalBody.appendChild(wrap);
    modal.classList.add('show');
  }

  window.markDone = function(id){ const idx = ORDERS.findIndex(o=>o.id===id); if(idx===-1) return; ORDERS.splice(idx,1); saveState(); renderOrdersPanel(); }
  window.deleteOrder = function(id){ if(!confirm('تأكيد حذف الطلب؟')) return; ORDERS = ORDERS.filter(o=>o.id!==id); saveState(); renderOrdersPanel(); }

  document.getElementById('viewOrders').onclick = ()=>{ renderOrdersPanel(); }
  document.getElementById('clearOrders').onclick = ()=>{ if(confirm('مسح كل الطلبات من الجهاز؟')){ ORDERS=[]; saveState(); alert('تم مسح الطلبات') } }
  document.getElementById('exportOrders').onclick = ()=>{ const dataStr = JSON.stringify(ORDERS, null,2); const blob = new Blob([dataStr], {type:'application/json'}); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href=url; a.download='orders.json'; a.click(); URL.revokeObjectURL(url); }

  document.getElementById('openCart').onclick = openCart;
  document.getElementById('openCartFloating').onclick = openCart;
  document.getElementById('closeModal').onclick = ()=>{ modal.classList.remove('show') }

  // search
  document.getElementById('search').addEventListener('input', ()=>renderProducts());

  // logo click to edit (owner only) - we show prompt for URL or text
  document.getElementById('logo').onclick = ()=>{
    if(!ownerMode){ alert('لتعديل اللوغو: فعّل وضع صاحب المتجر أولاً (زر "وضع صاحب المتجر"). كلمة المرور الافتراضية: admin') ; return }
    const v = prompt('ضع نص اللوغو أو رابط صورة (اتركه فارغ للعودة للافتراضي)');
    if(v===null) return;
    if(v.startsWith('http')){ document.getElementById('logo').innerHTML = `<img src='${v}' alt='logo' style='height:100%;width:auto;border-radius:8px'/>`; }
    else{ document.getElementById('logo').textContent = v || 'لوغو (اضغط لتعديل)'; }
  }

  // utils
  function init(){ renderCategories(); selectCategory(''); renderProducts(); updateCartBadge(); }
  init();

  // small note to user (داخل الكود) لتهيئة EmailJS لو أحب المستخدم
  console.log('ملف المتجر جاهز. لتفعيل الإرسال التلقائي عبر البريد من المتصفح، قم بتهيئة EmailJS أو خدمة مماثلة. شاهد التعليقات داخل الكود.')
  </script>
</body>
</html>
